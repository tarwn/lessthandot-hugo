---
title: Calculating the length of a hash in SQL Server
author: Koen Verbeeck
type: post
date: 2014-02-11T13:08:15+00:00
ID: 2343
url: /index.php/datamgmt/dbprogramming/mssqlserver/calculating-the-length-of-a-hash-in-sql-server/
views:
  - 27225
rp4wp_auto_linked:
  - 1
categories:
  - Microsoft SQL Server
  - SSIS
tags:
  - hash
  - sql server
  - ssis
  - syndicated

---
<p style="text-align: justify">
  Some time ago I added a script component to a few SSIS packages to compare rows with each other using a <a href="http://en.wikipedia.org/wiki/Hash_function">hash</a> to check if they had actually changed or not. In the output of the script component, I had chosen a string data type for the calculated hash with a length of 66 characters. In the destination table, I created a column with data type char(66) to store the hash value.
</p>

<p style="text-align: justify">
  <a href="/wp-content/uploads/2014/02/ScriptOutput.png"><img class="size-full wp-image-2345 alignnone" alt="ScriptOutput" src="/wp-content/uploads/2014/02/ScriptOutput.png" width="734" height="421" srcset="/wp-content/uploads/2014/02/ScriptOutput.png 734w, /wp-content/uploads/2014/02/ScriptOutput-300x172.png 300w" sizes="(max-width: 734px) 100vw, 734px" /></a>
</p>

<p style="text-align: justify">
  <span style="line-height: 1.5em">Of course, a few weeks later I had completely forgotten why I had chosen that particular length. That’s why I wrote this blog post, so that I might never forget it again.</span>
</p>

<p style="text-align: justify">
  In the script component, I used the SHA256CryptoServiceProvider to calculate the hash. When we use the T-SQL equivalent <a href="http://technet.microsoft.com/en-us/library/ms174415.aspx">HASHBYTES</a>, it is easy to see the 66 characters:
</p>

<p style="text-align: justify">
  <a href="/wp-content/uploads/2014/02/hashbytes.png"><img class="alignnone size-full wp-image-2347" alt="hashbytes" src="/wp-content/uploads/2014/02/hashbytes.png" width="603" height="129" srcset="/wp-content/uploads/2014/02/hashbytes.png 603w, /wp-content/uploads/2014/02/hashbytes-300x64.png 300w" sizes="(max-width: 603px) 100vw, 603px" /></a>
</p>

<p style="text-align: justify">
  We have the 64 characters generated by the hash plus the 0x that precedes the hex string. The question is however: where do they come from? The SHA function outputs 256 bits, which equals 32 characters. So why do I have 66 characters instead of 34, knowing that a character takes up one single byte in SQL Server?
</p>

<p style="text-align: justify">
  I took another look at the code generating the hash:
</p>

<p style="text-align: justify">
  <a href="/wp-content/uploads/2014/02/Code.png"><img class="alignnone size-full wp-image-2346" alt="Code" src="/wp-content/uploads/2014/02/Code.png" width="857" height="242" srcset="/wp-content/uploads/2014/02/Code.png 857w, /wp-content/uploads/2014/02/Code-300x84.png 300w" sizes="(max-width: 857px) 100vw, 857px" /></a>
</p>

<p style="text-align: justify">
  That’s when it hit me: the text input is first encoded the Unicode, so when you directly cast the output hex string to a string, you might get Unicode characters as well. And indeed, when you cast in T-SQL:
</p>

<p style="text-align: justify">
  <a href="/wp-content/uploads/2014/02/hashbytes_cast.png"><img class="alignnone size-full wp-image-2348" alt="hashbytes_cast" src="/wp-content/uploads/2014/02/hashbytes_cast.png" width="584" height="233" srcset="/wp-content/uploads/2014/02/hashbytes_cast.png 584w, /wp-content/uploads/2014/02/hashbytes_cast-300x119.png 300w" sizes="(max-width: 584px) 100vw, 584px" /></a>
</p>

<p style="text-align: justify">
  We have our 32 characters, they are only in Unicode. And as you might know, SQL Server uses not one byte to represent Unicode characters, but two bytes. For example, the hexadecimal representation of Ç (capital C with cedilla) is 00C7, or C7 for friends. Two characters indeed.
</p>

<p style="text-align: justify">
  The for loop in the C# code takes the byte stream generated by the hash output and converts it byte per byte to a string and appends it to the result. This gives us our 66 characters as well.
</p>

<p style="text-align: justify">
  So, now you know and I hopefully don’t forget.
</p>